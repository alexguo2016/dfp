# 小程序开发, 学习笔记

## 小程序的开发者工具使用的是 react, redux 等等技术来搭建的, 基于 nw.js, 使用 node.js, chromium 和系统 api 来实现底层模块

## 代码编译

### 编译 wxml

开发者工具模拟器的代码只经过本地预处理和本地编译, 没有经过服务器编译
微信客户端运行的代码是额外经过服务器编译的

编译过程中, 将所有的 wxml 代码变成一个 JavaScript 函数, 预先注入在 webview 中

### 编译 wxss

内置的 wxss 编译器, 同时预处理 rpx 和 import 等等关系, 输出一个样式信息数组

### 编译 JavaScript

因为微信客户端运行小程序的时候, 只需要家族一个 js 文件, app-service.js, 我们写的 JavaScript 代码会在被上传的时候, 有微信开发者工具进行一系列的处理, 例如 es6-->es5 和代码压缩

## 模拟器

## 分包加载

如果代码比较大, 可以将比较主要的页面先行加载, 其中 app.json 如下设置

```js
{
  "pages":[
    "pages/index",
    "pages/logs"
  ],
  "subPackages": [
    {
      "root": "packageA",
      "pages": [
        "pages/cat",
        "pages/dog"
      ]
    }, {
      "root": "packageB",
      "pages": [
        "pages/apple",
        "pages/banana"
      ]
    }
  ]
}
```

使用分包加载的时候, 需要注意代码和资源文件目录的划分, 启东市需要访问的页面和起依赖文件, 应该放在主包中

## 代码包的加载

小程序的代码包被下载之后, 会自动运行一次, 小程序的基础库会完成所有页面的注册, 调用 page 构造器的时候, 小程序基础库会记录页面的基础信心, 例如初始数据 data 等等
需要注意的是, 如果一个页面被多次创建, 并不会使得页面所在的 js 文件被执行多次, 仅仅是根据初始数据多生成了一个页面示例(this), 在页面 js 文件中直接定义的变量, 在 <b>所有这个页面的实例质检是共享的</b>

## 页面层级准备

在视图层内, 小程序的每一个页面都独立运行在一个页面层级上,  一开始启动的时候, 仅有一个页面层级, 每次调用 wx.navigateTo 的时候, 都会创建一个新的页面  层级 wx.navigateBack 会销毁一个页面层级

而对于 wx.redirectTo, 不会打开一个新的页面层级, 而是将当前页面层级重新初始化, 清空当前页面层级的渲染结果然后重新渲染页面

## 页面初始数据通信

初始渲染在 onReady 之前, onLoad 之后

https://developers.weixin.qq.com/ebook?action=get_post_info&docid=000ee81299cab83b0086dba4e56c0a
